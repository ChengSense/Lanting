!function(){"use strict";function e(e,t){for(var i,o=t;o--;)for(var n=e;n--;)if(i=x[n+"&"+o])return i}function t(e){var t,i;return e.layerX||0==e.layerX?(t=e.layerX,i=e.layerY):(e.offsetX||0==e.offsetX)&&(t=e.offsetX,i=e.offsetY),{x:t,y:i}}function i(e,t){for(var i in t)e[i]=t[i];return e}var o=document.createElement("canvas"),n=o.getContext("2d");function a(e){window.devicePixelRatio&&(o.style.width=b+"px",o.style.height=X+"px",o.width=W.width,o.height=W.height,n.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e){i(n,{font:"14px Arial"}),t=e,t.forEach(function(e){e.forEach(function(e){n.fillText(e.text,e.x+3,e.y+15)})});var t}(e)}var r=document.createElement("canvas"),c=r.getContext("2d");function f(e,t){window.devicePixelRatio&&(r.style.width=b+"px",r.style.height=X+"px",r.width=W.width,r.height=W.height,c.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e,t){i(c,{strokeStyle:"#d0d3d7",lineCap:"butt"}),function(e,t){var i=-1;c.beginPath();for(;++i<t.length;){var o=t[i];c.moveTo(o.x,o.y),c.lineTo(o.x,o.height+.5),0<i&&(c.fillStyle="#f7f7f7",c.fillRect(o.x,0,o.width,o.height),c.fillStyle="black",c.fillText(o.text,o.x+3,o.y+15))}c.stroke()}(0,t)}(0,t)}var l=document.createElement("canvas"),d=l.getContext("2d"),h=120,s=30;function u(e,t){window.devicePixelRatio&&(l.style.width=b+"px",l.style.height=X+"px",l.width=W.width,l.height=W.height,d.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e,t){i(d,{strokeStyle:"#d0d3d7",lineCap:"butt"}),function(e,t){var i=-1;d.beginPath();for(;++i<e.length;){var o=e[i][0];d.moveTo(o.x,o.y),d.lineTo(o.width+.5,o.y),0<i&&(d.fillStyle="#f7f7f7",d.fillRect(0,o.y,o.width,o.height),d.fillStyle="black",d.fillText(o.text,o.x+3,o.y+15))}d.stroke()}(e)}(e)}var x={},v={data:function(e,t){e=e||50,t=t||50;for(var i=-1,o=.5,n=[];++i<e;){for(var a=-1,r=.5,c=[];++a<t;)c.push(w(i,a,r,o,h,s)),r+=h;n.push(c),o+=s}return n},redata:function(e){x={};var t=.5;return e.forEach(function(e){var i,o=.5;e.forEach(function(e){i=e,e.x=o,e.y=t,x[parseInt(e.x)+"&"+parseInt(e.y)]=e,o+=e.width}),t+=i.height}),e},redatax:function(e,t,i){var o=t.id.split(":")[1]-1;return e.forEach(function(e){var t=e[o];t.width=t.width+i}),console.log(e),e},title:function(){var e=[""].concat(O);return O.forEach(function(t){O.forEach(function(i){e.push(""+t+i)})}),e}};function w(e,t,i,o,n,a){var r,c=v.title();return r=0<e&&0==t?{id:e+":"+t,x:i,y:o,width:n,height:a,text:e}:0<t&&0==e?{id:e+":"+t,x:i,y:o,width:n,height:a,text:c[t]}:0==e&&0==t?{id:e+":"+t,x:i,y:o,width:n,height:a,text:""}:{id:e+":"+t,x:i,y:o,width:n,height:a,text:e+":"+t},x[parseInt(r.x)+"&"+parseInt(r.y)]=r,r}var g=document.createElement("canvas"),p=g.getContext("2d");function y(e,t){window.devicePixelRatio&&(g.style.width=b+"px",g.style.height=X+"px",g.width=W.width,g.height=W.height,p.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e,t){i(p,{strokeStyle:"#d0d3d7",lineCap:"butt"}),function(e,t){var i=-1,o=-1;p.beginPath();for(;++i<e.length;){var n=e[i][0];p.moveTo(n.x,n.y),p.lineTo(b+.5,n.y),0<i&&(p.fillStyle="#f7f7f7",p.fillRect(0,n.y,n.width,n.height))}for(;++o<t.length;){var n=t[o];p.moveTo(n.x,.5),p.lineTo(n.x,X+.5),0<o&&(p.fillStyle="#f7f7f7",p.fillRect(n.x,0,n.width,n.height))}p.stroke()}(e,t),f(0,t),u(e)}(e,t)}var m={line:function(e,t,i){e.moveTo(t.x,t.y),e.lineTo(i.x,i.y)},area:function(e,t){z.beginPath(),z.clearRect(0,0,b,X),z.fillStyle="#e3edf9",z.fillRect(e.x,e.y,t.x-e.x+t.width,t.y-e.y+t.height),z.rect(e.x,e.y,t.x-e.x+t.width,t.y-e.y+t.height),z.drawImage(g,0,0,b,X),z.drawImage(o,0,0,b,X),z.strokeStyle="#006dff",z.lineWidth=2,z.stroke()},render:function(e){z.beginPath(),z.clearRect(0,0,b,X),z.drawImage(g,0,0,b,X),z.drawImage(o,0,0,b,X),e&&(z.strokeStyle="#006dff",z.lineWidth=1.5,z.rect(e.x,e.y,e.width,e.height)),z.stroke()},scrollX:function(e,t){z.beginPath(),z.clearRect(0,0,b,X),z.drawImage(o,-parseInt(e.x),-parseInt(t.y),b,X),z.drawImage(g,-parseInt(e.x),-parseInt(t.y),b,X),z.globalCompositeOperation="source-over",z.drawImage(r,-parseInt(e.x),0,b,X),z.drawImage(l,0,-parseInt(t.y),b,X),z.globalCompositeOperation="destination-over",z.stroke()},scrollY:function(e,t){z.beginPath(),z.clearRect(0,0,b,X),z.drawImage(o,-parseInt(t.x),-parseInt(e.y),b,X),z.drawImage(g,-parseInt(t.x),-parseInt(e.y),b,X),z.globalCompositeOperation="source-over",z.drawImage(r,-parseInt(t.x),0,b,X),z.drawImage(l,0,-parseInt(e.y),b,X),z.globalCompositeOperation="destination-over",z.stroke()}},I={x:.5,y:.5};function R(){var t,i,o,n=$(".sm-sheet-scrollbar-horizontal"),a=$(document);function r(a){var r=a.pageX-t;r<0&&(r=0),n.offset({left:r}),function(t){var n=e(t,i);n&&(o=n,I.x=n.x,m.scrollX(o,I))}(r)}function c(){a.off("mousemove",r).off("mouseup",c)}n.mousedown(function(n){t=n.offsetX,i=n.pageY,(o=e(n.pageX,n.pageY))&&a.mousemove(r).mouseup(c)})}function P(){var t,i,o,n=$(".sm-sheet-scrollbar-vertical"),a=$(document);function r(a){var r=a.pageY-i;r<0&&(r=0),n.offset({top:r}),function(i){var n=e(t,i);n&&(o=n,I.y=n.y,m.scrollY(o,I))}(r)}function c(){a.off("mousemove",r).off("mouseup",c)}n.mousedown(function(n){t=n.pageX,i=n.offsetY,(o=e(n.pageX,n.pageY))&&a.mousemove(r).mouseup(c)})}var b,X,k,T=$("canvas"),S=$("textarea"),C={};function E(){var i,o,n,r;!function(){var i;function o(o){var n=t(o);(i.x+i.width<n.x||i.y+i.height<n.y)&&(i=e(n.x,n.y))&&m.area(C,i)}n.mousedown(function(a){var r=t(a);S.hide(),(C=i=e(r.x,r.y))&&(m.render(C),n.mousemove(o))}).mouseup(function(e){n.off("mousemove",o),S.off("change")}).dblclick(Y)}(),R(),P(),n=$("canvas"),r=$(document),n.mousemove(function(t){var c=e(t.pageX,t.pageY);function f(t){var n=e(t.pageX,t.pageY);i=n.x,o=n}function l(e){var t=parseInt(e.pageX-i);v.redatax(k,o,t),v.redata(k),a(k),y(k,k[0]),m.render(),o=null,n.off("mousedown",f),r.off("mouseup",l)}c&&(Math.abs(c.x-t.pageX)<8?(n.css({cursor:"col-resize"}),o||(n.mousedown(f),r.mouseup(l),o=c)):o&&(n.css({cursor:"default"}),n.off("mousedown",f),r.off("mouseup",l)))})}function Y(i){var o=t(i),a=e(o.x,o.y);a&&(function(e){var t=e.y+T.position().top,i=e.x+T.position().left;S.show().focus(),S.css({left:i,top:t,width:"116px",height:"26px"}),S.val(e.text)}(a),function(e){S.change(function(){e.text=this.value,function(e){n.clearRect(e.x,e.y,e.width,e.height),n.fillText(e.text,e.x+3,e.y+15)}(e),m.render()})}(a))}var O=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],W=document.querySelector("#canvas"),z=W.getContext("2d");b=$(W).parent().width(),X=$(W).parent().height(),window.devicePixelRatio&&(W.style.width=b+"px",W.style.height=X+"px",W.width=b*window.devicePixelRatio,W.height=X*window.devicePixelRatio,z.scale(window.devicePixelRatio,window.devicePixelRatio),a(k=v.data()),y(k,k[0]),m.render(),E())}();
