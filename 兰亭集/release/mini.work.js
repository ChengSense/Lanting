!function(){"use strict";function e(e,t){for(var i,o=t;o--;)for(var n=e;n--;)if(i=l[n+"&"+o])return i}function t(e){var t=e.id.split(":");return{x:t[1],y:t[0]}}function i(e){var t,i;return e.layerX||0==e.layerX?(t=e.layerX,i=e.layerY):(e.offsetX||0==e.offsetX)&&(t=e.offsetX,i=e.offsetY),{x:t,y:i}}function o(e,t){for(var i in t)e[i]=t[i];return e}var n=document.createElement("canvas"),a=n.getContext("2d"),r=120,f=30;function c(e,t){window.devicePixelRatio&&(n.style.width=k+"px",n.style.height=T+"px",n.width=W.width,n.height=W.height,a.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e,t){o(a,{strokeStyle:"#d0d3d7",lineCap:"butt"}),function(e,t){var i=-1;a.beginPath();for(;++i<e.length;){var o=e[i][0];a.moveTo(o.x,o.y),a.lineTo(o.width+.5,o.y),0<i&&(a.fillStyle="#f7f7f7",a.fillRect(0,o.y,o.width,o.height),a.fillStyle="black",a.fillText(o.text,o.x+3,o.y+15))}a.stroke()}(e)}(e)}var l={},d={data:function(e,t){e=e||50,t=t||50;for(var i=-1,o=.5,n=[];++i<e;){for(var a=-1,c=.5,l=[];++a<t;)l.push(h(i,a,c,o,r,f)),c+=r;n.push(l),o+=f}return n},redata:function(e){l={};var t=.5;return e.forEach(function(e){var i,o=.5;e.forEach(function(e){i=e,e.x=o,e.y=t,l[parseInt(e.x)+"&"+parseInt(e.y)]=e,o+=e.width}),t+=i.height}),e},redatax:function(e,i,o){var n=t(i).x;return e.forEach(function(e){var t=e[n];t.width=t.width+o}),e},title:function(){var e=[""].concat(z);return z.forEach(function(t){z.forEach(function(i){e.push(""+t+i)})}),e}};function h(e,t,i,o,n,a){var r,f=d.title();return r=0<e&&0==t?{id:e+":"+t,x:i,y:o,width:n,height:a,text:e}:0<t&&0==e?{id:e+":"+t,x:i,y:o,width:n,height:a,text:f[t]}:0==e&&0==t?{id:e+":"+t,x:i,y:o,width:n,height:a,text:""}:{id:e+":"+t,x:i,y:o,width:n,height:a,text:e+":"+t},l[parseInt(r.x)+"&"+parseInt(r.y)]=r,r}var s=document.createElement("canvas"),u=s.getContext("2d");function x(e){window.devicePixelRatio&&(s.style.width=k+"px",s.style.height=T+"px",s.width=W.width,s.height=W.height,u.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e){o(u,{font:"14px Arial"}),t=e,t.forEach(function(e){e.forEach(function(e){u.fillText(e.text,e.x+3,e.y+15)})});var t}(e)}var w=document.createElement("canvas"),v=w.getContext("2d");function g(e,t){window.devicePixelRatio&&(w.style.width=k+"px",w.style.height=T+"px",w.width=W.width,w.height=W.height,v.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e,t){o(v,{strokeStyle:"#d0d3d7",lineCap:"butt"}),function(e,t){var i=-1;v.beginPath();for(;++i<t.length;){var o=t[i];v.moveTo(o.x,o.y),v.lineTo(o.x,o.height+.5),0<i&&(v.fillStyle="#f7f7f7",v.fillRect(o.x,0,o.width,o.height),v.fillStyle="black",v.fillText(o.text,o.x+3,o.y+15))}v.stroke()}(0,t)}(0,t)}var p=document.createElement("canvas"),y=p.getContext("2d");function m(e,t){window.devicePixelRatio&&(p.style.width=k+"px",p.style.height=T+"px",p.width=W.width,p.height=W.height,y.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e,t){o(y,{strokeStyle:"#d0d3d7",lineCap:"butt"}),function(e,t){var i=-1,o=-1;y.beginPath();for(;++i<e.length;){var n=e[i][0];y.moveTo(n.x,n.y),y.lineTo(k+.5,n.y),0<i&&(y.fillStyle="#f7f7f7",y.fillRect(0,n.y,n.width,n.height))}for(;++o<t.length;){var n=t[o];y.moveTo(n.x,.5),y.lineTo(n.x,T+.5),0<o&&(y.fillStyle="#f7f7f7",y.fillRect(n.x,0,n.width,n.height))}y.stroke()}(e,t),g(0,t),c(e)}(e,t)}var I={line:function(e,t,i){e.moveTo(t.x,t.y),e.lineTo(i.x,i.y)},area:function(e,t){A.beginPath(),A.clearRect(0,0,k,T),A.fillStyle="#e3edf9",A.fillRect(e.x,e.y,t.x-e.x+t.width,t.y-e.y+t.height),A.rect(e.x,e.y,t.x-e.x+t.width,t.y-e.y+t.height),A.drawImage(p,0,0,k,T),A.drawImage(s,0,0,k,T),A.strokeStyle="#006dff",A.lineWidth=2,A.stroke()},render:function(e){A.beginPath(),A.clearRect(0,0,k,T),A.drawImage(p,0,0,k,T),A.drawImage(s,0,0,k,T),e&&(A.strokeStyle="#006dff",A.lineWidth=1.5,A.rect(e.x,e.y,e.width,e.height)),A.stroke()},scrollX:function(e,t){A.beginPath(),A.clearRect(0,0,k,T),A.drawImage(s,-parseInt(e.x),-parseInt(t.y),k,T),A.drawImage(p,-parseInt(e.x),-parseInt(t.y),k,T),A.globalCompositeOperation="source-over",A.drawImage(w,-parseInt(e.x),0,k,T),A.drawImage(n,0,-parseInt(t.y),k,T),A.globalCompositeOperation="destination-over",A.stroke()},scrollY:function(e,t){A.beginPath(),A.clearRect(0,0,k,T),A.drawImage(s,-parseInt(t.x),-parseInt(e.y),k,T),A.drawImage(p,-parseInt(t.x),-parseInt(e.y),k,T),A.globalCompositeOperation="source-over",A.drawImage(w,-parseInt(t.x),0,k,T),A.drawImage(n,0,-parseInt(e.y),k,T),A.globalCompositeOperation="destination-over",A.stroke()}},R={x:.5,y:.5};function P(){var t,i,o,n=$(".sm-sheet-scrollbar-horizontal"),a=$(document);function r(a){var r=parseInt(a.pageX-t);r<0&&(r=0),n.offset({left:r}),function(t){var n=e(t,i);n&&(o=n,R.x=n.x,I.scrollX(o,R))}(r)}function f(){a.off("mousemove",r).off("mouseup",f)}n.mousedown(function(n){t=n.offsetX,i=n.pageY,(o=e(n.pageX,n.pageY))&&a.mousemove(r).mouseup(f)})}function b(){var t,i,o,n=$(".sm-sheet-scrollbar-vertical"),a=$(document);function r(a){var r=a.pageY-i;r<0&&(r=0),n.offset({top:r}),function(i){var n=e(t,i);n&&(o=n,R.y=n.y,I.scrollY(o,R))}(r)}function f(){a.off("mousemove",r).off("mouseup",f)}n.mousedown(function(n){t=n.pageX,i=n.offsetY,(o=e(n.pageX,n.pageY))&&a.mousemove(r).mouseup(f)})}function X(){var i,o,n,a=$("canvas"),r=$(".split-vertical"),f=$(document);function c(o){f.mouseup(l),a.off("mousedown",c),r.show();var d=e(o.pageX,o.pageY);Math.abs(d.x+d.width-o.pageX)<8?i=(n=d).x+n.width:Math.abs(d.x-o.pageX)<8&&(n=function(e){var i=t(e);return S[i.y][i.x-1]}(d),i=n.x+n.width)}function l(e){if(n){var t=parseInt(e.pageX-i);d.redatax(S,n,t),d.redata(S),q(),n=null,r.hide(),f.off("mouseup",l)}}a.mousemove(function(i){if(n)return r.css({left:i.pageX,top:0});var f=e(i.pageX,i.pageY);if(f)if(Math.abs(f.x+f.width-i.pageX)<8&&0==t(f).y){if(a.css({cursor:"col-resize"}),o)return;a.mousedown(c),o=f}else if(Math.abs(f.x-i.pageX)<8&&0==t(f).y){if(a.css({cursor:"col-resize"}),o)return;a.mousedown(c),o=f}else a.css({cursor:"default"}),a.off("mousedown",c),o=null})}var k,T,S,C=$("canvas"),E=$("textarea"),Y={};function M(){!function(){var o;function n(t){var n=i(t);(o.x+o.width<n.x||o.y+o.height<n.y)&&(o=e(n.x,n.y))&&I.area(Y,o)}C.mousedown(function(a){var r=i(a);E.hide(),(Y=o=e(r.x,r.y))&&(t(o).x<0||t(o).y<0)&&I.render(Y);C.mousemove(n)}).mouseup(function(e){C.off("mousemove",n),E.off("change")}).dblclick(O)}(),P(),b(),X()}function O(t){var o=i(t),n=e(o.x,o.y);n&&(function(e){var t=e.y+C.position().top,i=e.x+C.position().left;E.show().focus(),E.css({left:i,top:t,width:"116px",height:"26px"}),E.val(e.text)}(n),function(e){E.change(function(){e.text=this.value,function(e){u.clearRect(e.x,e.y,e.width,e.height),u.fillText(e.text,e.x+3,e.y+15)}(e),I.render()})}(n))}var z=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],W=document.querySelector("#canvas"),A=W.getContext("2d");function q(){x(S),m(S,S[0]),I.render()}k=$(W).parent().width(),T=$(W).parent().height(),window.devicePixelRatio&&(W.style.width=k+"px",W.style.height=T+"px",W.width=k*window.devicePixelRatio,W.height=T*window.devicePixelRatio,A.scale(window.devicePixelRatio,window.devicePixelRatio),S=d.data(),q(),M())}();
