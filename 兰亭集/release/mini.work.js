!function(){"use strict";function e(e,t){for(;t--;){var i=h[t];if(i)for(;e--;){var o=i[e];if(o)return o}}}function t(e,t,i){e=parseInt(e),t=parseInt(t);var o=h[t]||{};h[t]=o,o[e]=i}function i(e){var t=e.id.split(":");return{x:t[1],y:t[0]}}function o(e,t){for(var i in t)e[i]=t[i];return e}function n(e){var t,i;return e.layerX||0==e.layerX?(t=e.layerX,i=e.layerY):(e.offsetX||0==e.offsetX)&&(t=e.offsetX,i=e.offsetY),{x:t,y:i}}var a=document.createElement("canvas"),r=a.getContext("2d"),f=120,c=30;function s(e,t){window.devicePixelRatio&&(a.style.width=T+"px",a.style.height=S+"px",a.width=H.width,a.height=H.height,r.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e,t){o(r,{strokeStyle:"#d0d3d7",lineCap:"butt"}),function(e,t){var i=-1;r.beginPath();for(;++i<e.length;){var o=e[i][0];r.moveTo(o.x,o.y),r.lineTo(o.width+.5,o.y),0<i&&(r.fillStyle="#f7f7f7",r.fillRect(0,o.y,o.width,o.height),r.fillStyle="black",r.fillText(o.text,o.x+3,o.y+15))}r.stroke()}(e)}(e)}var h={},l={data:function(e,t){e=e||50,t=t||50;for(var i=-1,o=.5,n=[];++i<e;){for(var a=-1,r=.5,s=[];++a<t;)s.push(u(i,a,r,o,f,c)),r+=f;n.push(s),o+=c}return n},resetData:function(e){h={};var i=.5;return e.forEach(function(e){var o,n=.5;e.forEach(function(e){o=e,e.x=n,e.y=i,t(n,i,o),n+=e.width}),i+=o.height}),e},resetWidth:function(e,t,o){var n=i(t).x;e.forEach(function(e){var t=e[n];t.width=t.width+o})},resetHeight:function(e,t,o){e[i(t).y].forEach(function(e){e.height=e.height+o})},title:function(){var e=[""].concat(D);return D.forEach(function(t){D.forEach(function(i){e.push(""+t+i)})}),e}};function u(e,i,o,n,a,r){var f,c=l.title();return t(o,n,f=0<e&&0==i?{id:e+":"+i,x:o,y:n,width:a,height:r,text:e}:0<i&&0==e?{id:e+":"+i,x:o,y:n,width:a,height:r,text:c[i]}:0==e&&0==i?{id:e+":"+i,x:o,y:n,width:a,height:r,text:""}:{id:e+":"+i,x:o,y:n,width:a,height:r,text:e+":"+i}),f}var d=document.createElement("canvas"),x=d.getContext("2d");function g(e){window.devicePixelRatio&&(d.style.width=T+"px",d.style.height=S+"px",d.width=H.width,d.height=H.height,x.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e){o(x,{font:"14px Arial"}),t=e,t.forEach(function(e){e.forEach(function(e){x.fillText(e.text,e.x+3,e.y+15)})});var t}(e)}var w=document.createElement("canvas"),v=w.getContext("2d");function p(e,t){window.devicePixelRatio&&(w.style.width=T+"px",w.style.height=S+"px",w.width=H.width,w.height=H.height,v.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e,t){o(v,{strokeStyle:"#d0d3d7",lineCap:"butt"}),function(e,t){var i=-1;v.beginPath();for(;++i<t.length;){var o=t[i];v.moveTo(o.x,o.y),v.lineTo(o.x,o.height+.5),0<i&&(v.fillStyle="#f7f7f7",v.fillRect(o.x,0,o.width,o.height),v.fillStyle="black",v.fillText(o.text,o.x+3,o.y+15))}v.stroke()}(0,t)}(0,t)}var y=document.createElement("canvas"),m=y.getContext("2d");function I(e,t){window.devicePixelRatio&&(y.style.width=T+"px",y.style.height=S+"px",y.width=H.width,y.height=H.height,m.scale(window.devicePixelRatio,window.devicePixelRatio)),function(e,t){o(m,{strokeStyle:"#d0d3d7",lineCap:"butt"}),function(e,t){var i=-1,o=-1;m.beginPath();for(;++i<e.length;){var n=e[i][0];m.moveTo(n.x,n.y),m.lineTo(T+.5,n.y),0<i&&(m.fillStyle="#f7f7f7",m.fillRect(0,n.y,n.width,n.height))}for(;++o<t.length;){var n=t[o];m.moveTo(n.x,.5),m.lineTo(n.x,S+.5),0<o&&(m.fillStyle="#f7f7f7",m.fillRect(n.x,0,n.width,n.height))}m.stroke()}(e,t),p(0,t),s(e)}(e,t)}var R={line:function(e,t,i){e.moveTo(t.x,t.y),e.lineTo(i.x,i.y)},area:function(e,t){A.beginPath(),A.clearRect(0,0,T,S),A.fillStyle="#e3edf9",A.fillRect(e.x,e.y,t.x-e.x+t.width,t.y-e.y+t.height),A.rect(e.x,e.y,t.x-e.x+t.width,t.y-e.y+t.height),A.drawImage(y,0,0,T,S),A.drawImage(d,0,0,T,S),A.strokeStyle="#006dff",A.lineWidth=2,A.stroke()},render:function(e){A.beginPath(),A.clearRect(0,0,T,S),A.drawImage(y,0,0,T,S),A.drawImage(d,0,0,T,S),e&&(A.strokeStyle="#006dff",A.lineWidth=1.5,A.rect(e.x,e.y,e.width,e.height)),A.stroke()},scrollX:function(e,t){A.beginPath(),A.clearRect(0,0,T,S),A.drawImage(d,-parseInt(e.x),-parseInt(t.y),T,S),A.drawImage(y,-parseInt(e.x),-parseInt(t.y),T,S),A.globalCompositeOperation="source-over",A.drawImage(w,-parseInt(e.x),0,T,S),A.drawImage(a,0,-parseInt(t.y),T,S),A.globalCompositeOperation="destination-over",A.stroke()},scrollY:function(e,t){A.beginPath(),A.clearRect(0,0,T,S),A.drawImage(d,-parseInt(t.x),-parseInt(e.y),T,S),A.drawImage(y,-parseInt(t.x),-parseInt(e.y),T,S),A.globalCompositeOperation="source-over",A.drawImage(w,-parseInt(t.x),0,T,S),A.drawImage(a,0,-parseInt(e.y),T,S),A.globalCompositeOperation="destination-over",A.stroke()}},b={x:.5,y:.5};function P(){var t,i,o,n=$(".sm-sheet-scrollbar-horizontal"),a=$(document);function r(a){var r=parseInt(a.pageX-t);r<0&&(r=0),n.offset({left:r}),function(t){var n=e(t,i);n&&(o=n,b.x=n.x,R.scrollX(o,b))}(r)}function f(){a.off("mousemove",r).off("mouseup",f)}n.mousedown(function(n){t=n.offsetX,i=n.pageY,(o=e(n.pageX,n.pageY))&&a.mousemove(r).mouseup(f)})}function X(){var t,i,o,n=$(".sm-sheet-scrollbar-vertical"),a=$(document);function r(a){var r=a.pageY-i;r<0&&(r=0),n.offset({top:r}),function(i){var n=e(t,i);n&&(o=n,b.y=n.y,R.scrollY(o,b))}(r)}function f(){a.off("mousemove",r).off("mouseup",f)}n.mousedown(function(n){t=n.pageX,i=n.offsetY,(o=e(n.pageX,n.pageY))&&a.mousemove(r).mouseup(f)})}function Y(){var t,o,n,a=$(".split-vertical"),r=$("canvas"),f=$(document);function c(o){f.mouseup(s),r.off("mousedown",c),a.show();var h=e(o.pageX,o.pageY);Math.abs(h.x+h.width-o.pageX)<8?t=(n=h).x+n.width:Math.abs(h.x-o.pageX)<8&&(n=function(e){var t=i(e);return C[t.y][t.x-1]}(h),t=n.x+n.width)}function s(e){if(n){var i=parseInt(e.pageX-t);l.resetWidth(C,n,i),l.resetData(C),q(),n=null,a.hide(),f.off("mouseup",s)}}r.mousemove(function(t){if(n)return a.css({left:t.pageX,top:0});var f=e(t.pageX,t.pageY);if(f)if(Math.abs(f.x+f.width-t.pageX)<8&&0==i(f).y){if(r.css({cursor:"col-resize"}),o)return;r.mousedown(c),o=f}else if(Math.abs(f.x-t.pageX)<8&&0==i(f).y){if(r.css({cursor:"col-resize"}),o)return;r.mousedown(c),o=f}else 0<i(f).x&&(r.css({cursor:"default"}),r.off("mousedown",c),o=null)})}function k(){var t,o,n,a=$(".split-horizontal"),r=$("canvas"),f=$(document);function c(o){r.off("mousedown",c),f.mouseup(s),a.show();var h=e(o.pageX,o.pageY);Math.abs(h.y+h.height-o.pageY)<8?t=(n=h).y+n.height:Math.abs(h.y-o.pageY)<8&&(n=function(e){var t=i(e);return C[t.y-1][t.x]}(h),t=n.y+n.height)}function s(e){if(n){f.off("mouseup",s);var i=parseInt(e.pageY-t);l.resetHeight(C,n,i),l.resetData(C),a.hide(),q(),n=null}}r.mousemove(function(t){if(n)return a.css({left:0,top:t.pageY});var f=e(t.pageX,t.pageY);if(f)if(Math.abs(f.y+f.height-t.pageY)<8&&0==i(f).x){if(r.css({cursor:"row-resize"}),o)return;r.mousedown(c),o=f}else if(Math.abs(f.y-t.pageY)<8&&0==i(f).x){if(r.css({cursor:"row-resize"}),o)return;r.mousedown(c),o=f}else 0<i(f).y&&(r.css({cursor:"default"}),r.off("mousedown",c),o=null)})}var T,S,C,E=$("canvas"),M=$("textarea"),z={};function O(){!function(){var t;function o(i){var o=n(i);(t.x+t.width<o.x||t.y+t.height<o.y)&&(t=e(o.x,o.y))&&R.area(z,t)}E.mousedown(function(a){var r=n(a);M.hide(),(z=t=e(r.x,r.y))&&(i(t).x<0||i(t).y<0)&&R.render(z);E.mousemove(o)}).mouseup(function(e){E.off("mousemove",o),M.off("change")}).dblclick(W)}(),P(),X(),Y(),k()}function W(t){var i=n(t),o=e(i.x,i.y);o&&(function(e){var t=e.y+E.position().top,i=e.x+E.position().left;M.show().focus(),M.css({left:i+2,top:t+2,width:e.width-6,height:e.height-6}),M.val(e.text)}(o),function(e){M.change(function(){e.text=this.value,function(e){x.clearRect(e.x,e.y,e.width,e.height),x.fillText(e.text,e.x+3,e.y+15)}(e),R.render()})}(o))}var D=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],H=document.querySelector("#canvas"),A=H.getContext("2d");function q(){g(C),I(C,C[0]),R.render()}T=$(H).parent().width(),S=$(H).parent().height(),window.devicePixelRatio&&(H.style.width=T+"px",H.style.height=S+"px",H.width=T*window.devicePixelRatio,H.height=S*window.devicePixelRatio,A.scale(window.devicePixelRatio,window.devicePixelRatio),C=l.data(),q(),O())}();
