!function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=r(t);if(e){var a=r(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o(this,n)}}function s(t,e,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(n):a.value}})(t,e,n||t)}function h(t,e){for(;0<=e;e--){var n=x[e];if(n)for(;0<=t;t--){var i=n[t];if(i)return i}}}function f(t,e,n){t=parseInt(t),e=parseInt(e);var i=x[e]||{};x[e]=i,i[t]=n}function u(t){var e=t.id.split(":");return{x:e[1],y:e[0]}}function l(t){var e,n;return t.layerX||0==t.layerX?(e=t.layerX,n=t.layerY):(t.offsetX||0==t.offsetX)&&(e=t.offsetX,n=t.offsetY),{x:e+parseInt(j.x),y:n+parseInt(j.y)}}var x={},y={data:function(t,e){t=t||500,e=e||50;for(var n=-1,i=.5,r=[];++n<t;){for(var a=-1,o=.5,c=[];++a<e;)c.push(p(n,a,o,i,_.width,_.height)),o+=_.width;r.push(c),i+=_.height}return r},resetData:function(t){x={};var e=.5;return t.forEach(function(t){var n,i=.5;t.forEach(function(t){n=t,t.x=i,t.y=e,f(i,e,n),i+=t.width}),e+=n.height}),t},resetWidth:function(t,e,n){var i=u(e).x;t.forEach(function(t){var e=t[i];e.width=e.width+n})},resetHeight:function(t,e,n){t[u(e).y].forEach(function(t){t.height=t.height+n})},title:function(){return[""].concat(C)}};function p(t,e,n,i,r,a){var o,c=y.title();return f(n,i,o=0<t&&0==e?{id:"".concat(t,":").concat(e),x:n,y:i,width:r,height:a,text:t}:0<e&&0==t?{id:"".concat(t,":").concat(e),x:n,y:i,width:r,height:a,text:c[e]}:0==t&&0==e?{id:"".concat(t,":").concat(e),x:n,y:i,width:r,height:a,text:""}:{id:"".concat(t,":").concat(e),x:n,y:i,width:r,height:a,text:"".concat(t,":").concat(e)}),o}function v(){var t,e,n,i,r=$(".sm-sheet-scrollbar-horizontal"),a=$(document);function o(a){var o=parseInt(a.pageX-t);o<0&&(o=0),r.offset({left:o}),function(t){var r=h(t=parseInt(i*t),e);if(n==r)return;j.x=r.x,E.layer(),n=r}(o)}function c(){a.off("mousemove",o).off("mouseup",c)}r.mousedown(function(s){if(!(n=h(s.pageX,s.pageY)))return;a.mousemove(o).mouseup(c),f=m[0],u=f[f.length-1],i=(u.x+u.width-O)/(O-r.width()),t=s.offsetX,e=s.pageY;var f,u})}function d(){var t,e,n,i,r=$(".sm-sheet-scrollbar-vertical"),a=$(document);function o(a){var o=a.pageY-e;o<0&&(o=0),r.offset({top:o}),function(e){e=parseInt(i*e);var r=h(t,e);if(n==r)return;j.y=r.y,E.layer(),n=r}(o)}function c(){a.off("mousemove",o).off("mouseup",c)}r.mousedown(function(s){if(!(n=h(s.pageX,s.pageY)))return;a.mousemove(o).mouseup(c),f=m[m.length-1][0],i=(f.y+f.height-R)/(R-r.height()),t=s.pageX,e=s.offsetY;var f})}function g(){var t,e,n,i=$(".split-vertical"),r=$("canvas"),a=$(document);function o(e){a.mouseup(c),r.off("mousedown",o),i.show();var s=h(e.pageX,e.pageY);Math.abs(s.x+s.width-e.pageX)<8?t=(n=s).x+n.width:Math.abs(s.x-e.pageX)<8&&(n=function(t){var e=u(t);return m[e.y][e.x-1]}(s),t=n.x+n.width)}function c(e){if(n){a.off("mouseup",c);var r=parseInt(e.pageX-t);y.resetWidth(m,n,r),y.resetData(m),i.hide(),E.layer(),n=null}}r.mousemove(function(t){if(n)return i.css({left:t.pageX,top:0});var a=h(t.pageX,t.pageY);if(a)if(Math.abs(a.x+a.width-t.pageX)<8&&0==u(a).y){if(r.css({cursor:"col-resize"}),e)return;r.mousedown(o),e=a}else if(Math.abs(a.x-t.pageX)<8&&0==u(a).y){if(r.css({cursor:"col-resize"}),e)return;r.mousedown(o),e=a}else 0<u(a).x&&(r.css({cursor:"default"}),r.off("mousedown",o),e=null)})}function w(){var t,e,n,i=$(".split-horizontal"),r=$("canvas"),a=$(document);function o(e){r.off("mousedown",o),a.mouseup(c),i.show();var s=h(e.pageX,e.pageY);Math.abs(s.y+s.height-e.pageY)<8?t=(n=s).y+n.height:Math.abs(s.y-e.pageY)<8&&(n=function(t){var e=u(t);return m[e.y-1][e.x]}(s),t=n.y+n.height)}function c(e){if(n){a.off("mouseup",c);var r=parseInt(e.pageY-t);y.resetHeight(m,n,r),y.resetData(m),i.hide(),E.layer(),n=null}}r.mousemove(function(t){if(n)return i.css({left:0,top:t.pageY});var a=h(t.pageX,t.pageY);if(a)if(Math.abs(a.y+a.height-t.pageY)<8&&0==u(a).x){if(r.css({cursor:"row-resize"}),e)return;r.mousedown(o),e=a}else if(Math.abs(a.y-t.pageY)<8&&0==u(a).x){if(r.css({cursor:"row-resize"}),e)return;r.mousedown(o),e=a}else 0<u(a).y&&(r.css({cursor:"default"}),r.off("mousedown",o),e=null)})}var m,b,k,I,X,O,R,Y=$("canvas"),P=$("textarea");function S(){!function(){var t,e;function n(n){var i=l(n),r=h(i.x,i.y);e!=r&&(E.area(t,r),e=r)}Y.mousedown(function(i){P.hide();var r=l(i);(t=e=h(r.x,r.y))&&0<u(e).x&&0<u(e).y&&(E.border(t),Y.mousemove(n))}).mouseup(function(t){Y.off("mousemove",n),P.off("change")}).dblclick(T)}(),v(),d(),g(),w()}function T(t){var e=l(t),n=h(e.x,e.y);!function(t){var e=t.y+Y.position().top,n=t.x+Y.position().left;P.show().focus(),P.css({left:n-j.x+2,top:e-j.y+2,width:t.width-6,height:t.height-6}),P.val(t.text)}(n),function(t){P.change(function(){t.text=this.value,b.retext(t),E.layer()})}(n)}var E,j={x:.5,y:.5},C=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],M=window.devicePixelRatio,_={width:120,height:30};var D=function(){function e(){t(this,e),this.canvas=document.querySelector("#canvas"),this.cxt=this.canvas.getContext("2d"),O=$(this.canvas).parent().width(),R=$(this.canvas).parent().height(),O=$(this.canvas).parent().width(),R=$(this.canvas).parent().height(),M&&(this.canvas.style.width=O+"px",this.canvas.style.height=R+"px",this.canvas.width=O*M,this.canvas.height=R*M,this.cxt.scale(M,M)),this.layer(),S()}return n(e,[{key:"layer",value:function(){b=new q(m),k=new W(m,m[0]),this.draw()}},{key:"draw",value:function(){this.cxt.beginPath(),this.cxt.clearRect(0,0,O,R),this.cxt.drawImage(k.canvas,-parseInt(j.x),-parseInt(j.y),O,R),this.cxt.drawImage(b.canvas,-parseInt(j.x),-parseInt(j.y),O,R),this.cxt.globalCompositeOperation="source-over",this.cxt.drawImage(I.canvas,-parseInt(j.x),0,O,R),this.cxt.drawImage(X.canvas,0,-parseInt(j.y),O,R),this.cxt.globalCompositeOperation="destination-over",this.cxt.stroke()}},{key:"area",value:function(t,e){this.draw(),this.cxt.fillStyle="#e3edf9",this.cxt.fillRect(t.x-parseInt(j.x),t.y-parseInt(j.y),e.x-t.x+e.width,e.y-t.y+e.height),this.cxt.strokeStyle="#006dff",this.cxt.lineWidth=1.5,this.cxt.rect(t.x-parseInt(j.x),t.y-parseInt(j.y),e.x-t.x+e.width,e.y-t.y+e.height),this.cxt.globalCompositeOperation="source-over",this.cxt.stroke()}},{key:"border",value:function(t){this.draw(),this.cxt.beginPath(),this.cxt.strokeStyle="#006dff",this.cxt.lineWidth=1.5,this.cxt.rect(t.x-parseInt(j.x),t.y-parseInt(j.y),t.width,t.height),this.cxt.globalCompositeOperation="source-over",this.cxt.stroke()}}]),e}(),z=function(){function e(){t(this,e),this.canvas=document.createElement("canvas"),this.cxt=this.canvas.getContext("2d"),M&&(this.canvas.style.width=O+"px",this.canvas.style.height=R+"px",this.canvas.width=O*M,this.canvas.height=R*M,this.cxt.scale(M,M))}return n(e,[{key:"layer",value:function(){Object.assign(this.cxt,{strokeStyle:"#d0d3d7",lineCap:"butt",font:"14px Arial"})}}]),e}(),W=function(e){i(o,z);var a=c(o);function o(e,n){var i;return t(this,o),(i=a.call(this)).layer(e,n),i}return n(o,[{key:"layer",value:function(t,e){s(r(o.prototype),"layer",this).call(this),this.draw(t,e),I=new H(t,e),X=new A(t,e)}},{key:"draw",value:function(t,e){var n=-1,i=-1;for(this.cxt.beginPath();++n<t.length;){var r=t[n][0];this.cxt.moveTo(r.x,r.y),this.cxt.lineTo(O+.5,r.y),0<n&&(this.cxt.fillStyle="#f7f7f7",this.cxt.fillRect(0,r.y,r.width,r.height))}for(;++i<e.length;){r=e[i];this.cxt.moveTo(r.x,.5),this.cxt.lineTo(r.x,R+.5),0<i&&(this.cxt.fillStyle="#f7f7f7",this.cxt.fillRect(r.x,0,r.width,r.height))}this.cxt.stroke()}}]),o}(),H=function(e){i(o,z);var a=c(o);function o(e,n){var i;return t(this,o),(i=a.call(this)).layer(e,n),i}return n(o,[{key:"layer",value:function(t,e){s(r(o.prototype),"layer",this).call(this),this.draw(t,e)}},{key:"draw",value:function(t,e){var n=-1;for(this.cxt.beginPath();++n<e.length;){var i=e[n];this.cxt.moveTo(i.x,i.y),this.cxt.lineTo(i.x,i.height+.5),0<n&&(this.cxt.fillStyle="#f7f7f7",this.cxt.fillRect(i.x,0,i.width,i.height),this.cxt.fillStyle="black",this.cxt.fillText(i.text,i.x+3,i.y+15))}this.cxt.stroke()}}]),o}(),A=function(e){i(o,z);var a=c(o);function o(e,n){var i;return t(this,o),(i=a.call(this)).layer(e,n),i}return n(o,[{key:"layer",value:function(t,e){s(r(o.prototype),"layer",this).call(this),this.draw(t,e)}},{key:"draw",value:function(t,e){var n=-1;for(this.cxt.beginPath();++n<t.length;){var i=t[n][0];this.cxt.moveTo(i.x,i.y),this.cxt.lineTo(i.width+.5,i.y),0<n&&(this.cxt.fillStyle="#f7f7f7",this.cxt.fillRect(0,i.y,i.width,i.height),this.cxt.fillStyle="black",this.cxt.fillText(i.text,i.x+3,i.y+15))}this.cxt.stroke()}}]),o}(),q=function(e){i(o,z);var a=c(o);function o(e){var n;return t(this,o),(n=a.call(this)).layer(e),n}return n(o,[{key:"layer",value:function(t){s(r(o.prototype),"layer",this).call(this),this.draw(t)}},{key:"draw",value:function(t){var e=this;t.forEach(function(t){return t.forEach(function(t){return e.text(t)})})}},{key:"text",value:function(t){this.cxt.fillText(t.text,t.x+3,t.y+15)}},{key:"clear",value:function(t){this.cxt.clearRect(t.x,t.y,t.width,t.height)}},{key:"retext",value:function(t){this.clear(t),this.text(t)}}]),o}();m=y.data(),E=new D}();
